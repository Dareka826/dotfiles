#!/bin/sh
set -eu

page_style() {
  cat <<'EOF'
<style>
  body {
    margin: 0;
    padding: 0;
    height: 100vh;

    background: #222;
    color: #eee;
    font-size: 48pt;
    font-family: sans-serif;

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  a         { color: #58f; text-decoration: none; }
  a:visited { color: #85f; }
</style>
EOF
}

HTML="$(page_style)"

add_link() {
    HTML="${HTML}<span><a href=\"${1}\" target=\"_blank\">${2}</a></span>"
}

TITLE=""
if [ "${#}" = "2" ]; then
  TITLE="${2}"
fi

while [ "${#}" -gt 0 ]; do
    if [ "${#}" -gt 1 ]; then
        add_link "${1}" "${2}"
        shift 1
    else
        add_link "${1}" "${1}"
    fi
    shift 1
done

HTML="$(printf '%s' "${HTML}" | tr -s '\n' ' ')"

if [ "${TITLE}" = "" ]; then
  TITLE="Links $(printf '%s' "${HTML}" | md5sum | awk '{ print $1 }')"
fi
HTML="<title>${TITLE}</title>${HTML}"

printf '%s' "${HTML}" | base64 -w0 - | tr -d '\n' | sed -e '1 s|^|data:text/html;base64,|' -e 's|$|\n|'
